{
  "scan_metadata": {
    "generated": "2026-01-11",
    "scanner": "trivy",
    "scanner_version": "0.50.0 (expected)",
    "scan_type": "filesystem",
    "severity_threshold": ["HIGH", "CRITICAL"],
    "status": "BASELINE_DOCUMENTED",
    "note": "Actual scan requires trivy installation. This documents expected baseline."
  },
  "summary": {
    "total_images": 8,
    "external_base_images": 5,
    "custom_images": 3,
    "expected_status": "PASS"
  },
  "base_images_analysis": [
    {
      "image": "python:3.11-alpine3.19",
      "used_by": ["arc-sherlock-brain", "arc-scarlett-voice", "arc-base-python-ai"],
      "os": "Alpine Linux 3.19",
      "expected_vulnerabilities": "LOW",
      "notes": "Alpine images have minimal attack surface"
    },
    {
      "image": "python:3.12-alpine3.19",
      "used_by": ["arc-piper-tts"],
      "os": "Alpine Linux 3.19",
      "expected_vulnerabilities": "LOW",
      "notes": "Alpine images have minimal attack surface"
    },
    {
      "image": "golang:1.23-alpine3.19",
      "used_by": ["raymond (builder stage)"],
      "os": "Alpine Linux 3.19",
      "expected_vulnerabilities": "LOW",
      "notes": "Builder only - not in final image"
    },
    {
      "image": "alpine:3.19",
      "used_by": ["raymond (runtime stage)"],
      "os": "Alpine Linux 3.19",
      "expected_vulnerabilities": "MINIMAL",
      "notes": "Bare Alpine - excellent security posture"
    },
    {
      "image": "pgvector/pgvector:pg16",
      "used_by": ["arc-oracle-sql"],
      "os": "Debian (PostgreSQL official)",
      "expected_vulnerabilities": "MEDIUM",
      "notes": "Debian-based, may have more packages with CVEs"
    },
    {
      "image": "otel/opentelemetry-collector-contrib:0.98.0",
      "used_by": ["arc-otel-collector"],
      "os": "Scratch/Distroless",
      "expected_vulnerabilities": "LOW",
      "notes": "Official OTEL image, well-maintained"
    },
    {
      "image": "oryd/kratos:v1.3.0-alpine",
      "used_by": ["arc-deckard-identity"],
      "os": "Alpine Linux",
      "expected_vulnerabilities": "LOW",
      "notes": "Alpine variant of Ory Kratos"
    }
  ],
  "security_best_practices": {
    "non_root_users": {
      "status": "COMPLIANT",
      "details": "All 8 Dockerfiles run as non-root user"
    },
    "pinned_versions": {
      "status": "COMPLIANT",
      "details": "All base images use explicit version tags (no :latest)"
    },
    "multi_stage_builds": {
      "status": "COMPLIANT",
      "details": "6/8 use multi-stage builds (2 are thin wrappers around official images)"
    },
    "minimal_packages": {
      "status": "COMPLIANT",
      "details": "Alpine-based images, --no-cache used for apk"
    },
    "healthchecks": {
      "status": "COMPLIANT",
      "details": "All services have HEALTHCHECK instructions"
    },
    "secrets_in_images": {
      "status": "COMPLIANT",
      "details": "No secrets detected in Dockerfiles. Secrets via env/volumes at runtime"
    }
  },
  "ci_cd_integration": {
    "workflow": ".github/workflows/security-scan.yml",
    "schedule": "Daily at 6 AM UTC",
    "on_push": false,
    "on_pr": false,
    "manual_trigger": true,
    "notes": "Security scans run on schedule and manual trigger to avoid slowing PRs"
  },
  "remediation_notes": {
    "high_priority": [],
    "medium_priority": [
      "Consider migrating pgvector base to Alpine variant if one becomes available",
      "Pin apk packages to specific versions where critical"
    ],
    "low_priority": [
      "Standardize all Python services to same Python version (3.11 vs 3.12)"
    ]
  },
  "scan_commands": {
    "full_filesystem": "trivy fs --severity HIGH,CRITICAL .",
    "single_dockerfile": "trivy config services/arc-sherlock-brain/Dockerfile",
    "built_image": "trivy image arc-sherlock-brain:latest",
    "json_output": "trivy fs --format json --output reports/trivy-results.json .",
    "ci_scan": "./scripts/validate/check-security.sh"
  }
}
