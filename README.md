# Arc Framework - Observability Spike

This project is a technical spike to demonstrate a complete observability stack for a sample Go application (`swiss-army-go`) using OpenTelemetry. It serves as a blueprint for integrating robust logging, metrics, and tracing into services within the Arc Framework.

The Go application generates all three telemetry signals (logs, metrics, and traces), which are collected and visualized using a suite of best-in-class open-source tools orchestrated with Docker Compose.

## How to Run

1.  Make sure you have Docker and Docker Compose installed.
2.  From the root of the project, run the following command:
    ```sh
    docker-compose up -d --build
    ```
    This will build the necessary custom images and start all services in the background.

## Components

The `docker-compose.yml` file orchestrates the following services:

-   **`swiss-army-go`**: The sample Go application that generates telemetry data (logs, metrics, traces).
-   **`otel-collector`**: The OpenTelemetry Collector receives telemetry from the Go app, processes it (e.g., adds trace context to logs), and exports it to the appropriate backends.
-   **`loki`**: The log aggregation backend, which stores logs received from the collector.
-   **`prometheus`**: The time-series database that scrapes and stores metrics from the collector.
-   **`jaeger`**: The distributed tracing backend that stores and visualizes traces.
-   **`grafana`**: The primary visualization dashboard for viewing logs from Loki and metrics from Prometheus.

## Accessing Dashboards

Once the services are running, you can access the following web UIs from your browser:

### 1. Grafana (Logs & Metrics)

This is your main dashboard for visualizing logs and metrics. The Loki data source is auto-provisioned.

-   **URL**: **http://localhost:3000**
-   **Login**:
    -   Username: `admin`
    -   Password: `admin` (you will be prompted to change this on first login)
-   **How to see logs**:
    1.  Click the **Explore** (compass) icon on the left sidebar.
    2.  Ensure the **Loki** data source is selected at the top.
    3.  In the "Log browser" query field, enter: `{service_name="swiss-army-go"}` and run the query.
-   **How to see metrics**:
    1.  Click the **Explore** (compass) icon on the left sidebar.
    2.  Select the **Prometheus** data source from the dropdown at the top.
    3.  In the "Metric" query field, you can enter the name of a metric, for example: `background_runs_count_total`
    4.  Set the time range to "Last 5 minutes" and run the query.
-   **How to see SPM metrics (from traces)**:
    1.  In the Prometheus Explore view, you can now query for metrics generated from your traces.
    2.  For example, to see the P95 latency for your API endpoint, you can use a query like:
        ```
        histogram_quantile(0.95, sum(rate(calls_latency_bucket{service_name="swiss-army-go"}[5m])) by (le))
        ```

-   **How to see traces (via Jaeger)**:
    1.  Click the **Explore** (compass) icon on the left sidebar.
    2.  Select the **Jaeger** data source from the dropdown at the top.
    3.  Select the `swiss-army-go` service from the "Service" dropdown and click "Run query".
    4.  You can now see and analyze your application's traces directly within Grafana.

### 2. Jaeger (Traces)

This is where you can visualize the distributed traces from the Go application.

-   **URL**: **http://localhost:16686**
-   **How to see traces**:
    1.  On the "Search" page, select **`swiss-army-go`** from the "Service" dropdown.
    2.  The service now automatically generates traces every 10 seconds.
    3.  You can also trigger a trace on-demand by calling a new API endpoint. Open a new terminal and run:
        ```sh
        curl http://localhost:8081/ondemand-work
        ```
    4.  Back in the Jaeger UI, click the "Find Traces" button. You may need to wait a few seconds for the first background trace to appear.
    5.  You will see traces named:
        -   `background-work-iteration` (from the automatic worker)
        -   `HTTP GET /ondemand-work` (from your API call)

-   **Built-in Monitoring**:
    -   The Jaeger UI has a **Monitor** tab that displays RED metrics (Rate, Errors, Duration).
    -   Thanks to the configuration you've added, this tab is now powered by the metrics stored in **Prometheus**. These are the same high-quality metrics generated by the OTel Collector's `spanmetrics` connector, providing a consistent view between Jaeger and your Grafana dashboards.

### 3. Prometheus (Metrics Backend)

The Prometheus UI is useful for diagnostics and verifying that metrics are being collected.

-   **URL**: **http://localhost:9090**
-   **How to verify metrics collection**:
    1.  Navigate to the **Status** -> **Targets** menu.
    2.  You should see a target for the `otel-collector` job with a green `UP` state. This confirms that Prometheus is successfully scraping the metrics that your Go application is sending to the collector.