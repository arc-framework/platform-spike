# Traefik

**Status:** âœ… Active  
**Type:** Cloud-native API Gateway and Reverse Proxy

---

## Overview

Traefik serves as the API gateway and reverse proxy for the A.R.C. Framework, providing:

- **Dynamic Service Discovery** - Automatic configuration via Docker labels
- **Load Balancing** - Distribute traffic across service instances
- **SSL/TLS Termination** - Secure HTTPS endpoints
- **Request Routing** - Path-based and host-based routing
- **Middleware Support** - Authentication, rate limiting, compression
- **Dashboard** - Real-time monitoring and configuration visualization

---

## Configuration

### Static Configuration

The static configuration is defined in [`traefik.yml`](./traefik.yml):

- **Entry Points**: HTTP (`:80`) and HTTPS (`:443`)
- **Dashboard**: Enabled but only reachable from inside the Docker network (`api.insecure=false`)
- **Docker Provider**: Watches Docker socket for automatic service discovery

### Dynamic Configuration

Services are configured using Docker labels in `docker-compose` files. Example:

```yaml
labels:
  - 'traefik.enable=true'
  - 'traefik.http.routers.myservice.rule=Host(`myservice.localhost`)'
  - 'traefik.http.services.myservice.loadbalancer.server.port=8080'
```

### Environment Variables

Use the project-level `.env` file generated by `make generate-secrets` to override Traefik settings (for example, `TRAEFIK_LOG_LEVEL=INFO`). No service-specific `.env` files are required.

---

## Usage

### Starting Traefik

```bash
# Start the full platform (includes Traefik)
make up

# Core services profile (Traefik plus dependencies)
make up-minimal
```

### Accessing the Dashboard

The dashboard is exposed only on the internal Docker network. To review it locally, create a temporary override with secure routing:

```yaml
# docker-compose.override.yml
services:
  arc_traefik:
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.traefik-dashboard.rule=Host(`traefik.localhost`)'
      - 'traefik.http.routers.traefik-dashboard.entrypoints=websecure'
      - 'traefik.http.routers.traefik-dashboard.tls=true'
      - 'traefik.http.routers.traefik-dashboard.service=api@internal'
      - 'traefik.http.middlewares.traefik-auth.basicauth.users=${TRAEFIK_DASHBOARD_AUTH:?Set secure credentials}'
      - 'traefik.http.routers.traefik-dashboard.middlewares=traefik-auth'
```

Bring the stack back up (`make up`) so the override is picked up, then browse to `https://traefik.localhost/dashboard/`.

### Service Discovery

Traefik automatically discovers services labeled with `traefik.enable=true`. Services are exposed based on their routing rules.

---

## Ports

| Port         | Purpose                                               |
| ------------ | ----------------------------------------------------- |
| `80`         | HTTP entry point                                      |
| `443`        | HTTPS entry point                                     |
| _(internal)_ | Dashboard/API available via secure router (see above) |

---

## Health Check

Check Traefik health status:

```bash
docker compose -f deployments/docker/docker-compose.core.yml exec arc_traefik traefik healthcheck --ping
```

---

## Troubleshooting

### View Traefik Logs

```bash
docker compose -f deployments/docker/docker-compose.core.yml logs arc_traefik
```

### Check Service Discovery

After exposing the dashboard securely (see above), browse to the Traefik URL and navigate to **HTTP Routers** and **Services** for live state.

### Common Issues

1. **Service not routing**: Check that Docker labels are correctly set
2. **Port conflicts**: Ensure ports 80 and 443 are available
3. **Docker socket permission**: Traefik needs access to `/var/run/docker.sock`

---

## See Also

- [Gateway Overview](../README.md)
- [Traefik Documentation](https://doc.traefik.io/traefik/)
- [Docker Provider Configuration](https://doc.traefik.io/traefik/providers/docker/)
- [Operations Guide](../../../docs/OPERATIONS.md)
