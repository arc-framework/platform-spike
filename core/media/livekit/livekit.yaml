# A.R.C. LiveKit Server Configuration (arc-daredevil-voice)
# ==============================================================================
# High-performance WebRTC SFU for voice-first agentic intelligence
# ==============================================================================

# Port configuration
port: 7880
bind_addresses:
  - '0.0.0.0'

# RTC (Real-Time Communications) configuration
rtc:
  # UDP port range for WebRTC media streams
  # CRITICAL: These ports must be exposed in Docker and open in firewall
  port_range_start: 50000
  port_range_end: 60000

  # Use external IP for local development
  # Set to false in production with proper STUN/TURN configuration
  use_external_ip: true

  # TCP fallback port (when UDP is blocked)
  tcp_port: 7881

  # ICE server configuration (STUN/TURN)
  # For production, add TURN server for NAT traversal reliability
  ice_servers:
    - urls:
        - stun:stun.l.google.com:19302

  # Packet loss mitigation
  congestion_control:
    enabled: true
    # Start with conservative bandwidth estimation
    min_bandwidth: 100000 # 100 kbps
    max_bandwidth: 3000000 # 3 Mbps (sufficient for voice)

  # DTLS/SRTP configuration
  timeout: 15s

# Redis configuration for distributed state management
# MANDATORY: arc-sonic-cache must be running
redis:
  address: arc-sonic-cache:6379
  db: 0
  username: ''
  password: '' # Set via REDIS_PASSWORD env var if needed
  use_tls: false

# API Key/Secret pairs for authentication
# OVERRIDE: Set via LIVEKIT_KEYS environment variable
keys:
  # Default key for local development (CHANGE IN PRODUCTION)
  devkey: secret

# Room configuration
room:
  # Automatically create rooms when participants try to join
  auto_create: true

  # Close empty rooms after 5 minutes
  empty_timeout: 300

  # Maximum participants per room (voice agents count as participants)
  max_participants: 10

  # Departure timeout before removing participant
  departure_timeout: 20

# Logging configuration
logging:
  # Options: debug, info, warn, error
  level: info

  # Output format: json or text
  # Use json for structured logging with OTEL collector
  format: json

  # Sample rate for debug logs (reduce noise)
  sample: false

# Metrics and monitoring
# Prometheus-compatible metrics exposed on /metrics endpoint
metrics:
  enabled: true
  port: 7880 # Same as main port (shares HTTP server)

# TURN server configuration (for production NAT traversal)
# Uncomment and configure when deploying behind restrictive firewalls
# turn:
#   enabled: true
#   domain: turn.arc.example.com
#   tls_port: 5349
#   udp_port: 3478
#   external_tls: true

# Webhook configuration (optional)
# Send events to external services (e.g., for analytics)
# webhook:
#   urls:
#     - http://arc-analytics:8080/webhook
#   api_key: ${WEBHOOK_API_KEY}

# Region configuration for multi-region deployments (future)
# region: us-west-1

# Node configuration
# node_ip: ""  # Auto-detect

# Development mode settings
# DISABLE IN PRODUCTION
development: false

# Limit configuration (rate limiting)
limit:
  # Bytes per second per participant
  bytes_per_sec: 1000000 # 1 MB/s (generous for voice)

  # Max concurrent tracks per participant
  tracks_per_participant: 5
