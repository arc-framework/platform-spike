# A.R.C. Framework - Application Services
# ==============================================================================
# Application-level services, agents, and utilities
# These are your custom services built on top of the framework
# ==============================================================================

# Shared logging configuration
x-logging: &default-logging
  logging:
    driver: "json-file"
    options:
      max-size: "10m"
      max-file: "3"
      labels: "arc.service"

# Shared resource limits for medium services
x-resources-medium: &resources-medium
  deploy:
    resources:
      limits:
        cpus: '1.0'
        memory: 1G
      reservations:
        cpus: '0.25'
        memory: 256M

# Combined template
x-medium-service: &medium-service
  <<: *default-logging
  deploy:
    resources:
      limits:
        cpus: '1.0'
        memory: 1G
      reservations:
        cpus: '0.1'
        memory: 128M

services:
  # ===========================================================================
  # UTILITY - Toolbox Service (Demo/Testing)
  # ===========================================================================
  arc_toolbox:
    <<: *medium-service
    build:
      context: ../../services/utilities/toolbox
      dockerfile: Dockerfile
    image: arc/toolbox:latest
    container_name: arc_toolbox
    restart: unless-stopped
    environment:
      # OpenTelemetry Configuration
      OTEL_EXPORTER_OTLP_ENDPOINT: arc_otel_collector:4317
      OTEL_EXPORTER_OTLP_INSECURE: "true"
      OTEL_SERVICE_NAME: toolbox
      OTEL_RESOURCE_ATTRIBUTES: service.namespace=arc,service.version=1.0.0
      # Application Configuration
      SERVICE_PORT: ${TOOLBOX_PORT:-8081}
      LOG_LEVEL: ${LOG_LEVEL:-info}
    ports:
      - "8081:8081"
    networks:
      - arc_net
    depends_on:
      arc_otel_collector:
        condition: service_healthy
      arc_postgres:
        condition: service_healthy
      arc_redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8081/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    labels:
      - "arc.service.layer=application"
      - "arc.service.category=utility"
      - "arc.service.type=microservice"
      - "traefik.enable=true"
      - "traefik.http.routers.bootstrap.rule=Host(`bootstrap.localhost`)"
      - "traefik.http.services.bootstrap.loadbalancer.server.port=8081"

  # ===========================================================================
  # AGENT SERVICES - Placeholder for future agent implementations
  # ===========================================================================
  # Example structure for future agents:
  #
  # arc_reasoning_agent:
  #   build:
  #     context: ./services/agents/reasoning-agent
  #   container_name: arc_reasoning_agent
  #   environment:
  #     OTEL_EXPORTER_OTLP_ENDPOINT: arc_otel_collector:4317
  #     OTEL_SERVICE_NAME: reasoning-agent
  #   depends_on:
  #     - arc_otel_collector
  #     - arc_postgres
  #     - arc_nats
  #   networks:
  #     - arc_net
  #   labels:
  #     - "arc.service.layer=application"
  #     - "arc.service.category=agent"
  #     - "arc.service.type=ai-agent"
